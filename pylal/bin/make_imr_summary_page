#!/usr/bin/python
import sys, os, socket, re
import glob, math, shutil
from glue import cbcwebpage
from glue import lal
from glue import segments
from optparse import OptionParser

from pylal import git_version
__author__ = "Chad Hanna <channa@ligo.caltech.edu>"
__version__ = "git id %s" % git_version.id
__date__ = git_version.date

def parse_command_line():
	parser = OptionParser(version = "%prog CVS $Id$", usage = "%prog [options] [file ...]", description = "%prog summary web page")
	parser.add_option("--title", help = "Set the the title of the page default: IMR", default="IMR")
	opts, filenames = parser.parse_args()
	return opts, filenames

opts, files = parse_command_line()
base_name = ""

page = cbcwebpage.cbcpage(title=opts.title)
page.add_subpage("injections", "Injections", "Injections")

page.subpages["injections"].add_section("injected", "injected parameters")
imgtab = cbcwebpage.image_glob(base_name+"*1*2.png")
page.subpages["injections"].sections["injected"].add_table(imgtab,"injected spin and mass","injected spin and mass")

page.subpages["injections"].add_section("mass", "total mass missed found")
imgtab = cbcwebpage.image_glob(base_name+"*mass.png")
page.subpages["injections"].sections["mass"].add_table(imgtab,"total mass missed found", "total mass missed found")

page.subpages["injections"].add_section("chirpmass", "chirp mass missed found")
imgtab = cbcwebpage.image_glob(base_name+"*chirpmass.png")
page.subpages["injections"].sections["chirpmass"].add_table(imgtab,"Chirp mass missed found", "Chirp mass missed found")

page.subpages["injections"].add_section("spin", "final spin missed found")
imgtab = cbcwebpage.image_glob(base_name+"*finalspin.png")
page.subpages["injections"].sections["spin"].add_table(imgtab,"final spin missed found", "final spin missed found")

page.subpages["injections"].add_section("spin", "mass weighted final spin missed found")
imgtab = cbcwebpage.image_glob(base_name+"*massweightedspin.png")
page.subpages["injections"].sections["spin"].add_table(imgtab,"mass weighted final spin missed found", "mass weighted final spin missed found")

page.add_subpage("volume", "volume", "Detection volume")

#FIXME sort out base names
imgtab = cbcwebpage.image_glob("*-H1H2L1_distance.png")
page.subpages["volume"].add_section("distance",'"Sensemon" distance above a FAR')
page.subpages["volume"].sections["distance"].add_table(imgtab,"detection distance above a far", "detection distance above a far")

range_summs = glob.glob('*_range_summary.txt')
for rs in range_summs:
	tag = rs.replace('_',' ').replace('.txt','')
	page.subpages["volume"].add_section(tag,rs)
	tab,name = cbcwebpage.wiki_table_parse(rs)
	page.subpages["volume"].sections[tag].add_table(tab[0], "Range Summary", "Range summary")

page.write(base_name+"index")


